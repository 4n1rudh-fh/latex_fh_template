\chapter{Methodology}\label{chapter:methodology}    
    \vspace{5mm}
    \noindent FOr calibration 150 microsecnds was chosen. To verify the hexapod distance, the following procedure is used. Assuming the hexapod is moved to a random coordinate ($a_{x\ actual}$, $a_{y\ actual}$), images are recorded for this hexapod motion. With displacements in pixel units known from \gls{ncc} algorithm, and the calibration matrix parameters ($T_{xx}$, $T_{yx}$, $T_{xy}$, $T_{yy}$), Eqn. \ref{eqn:dist_calc} is used to calculate ($a_x$, $a_y$), which can be compared with actual hexapod coordinates ($a_{x\ actual}$, $a_{y\ actual}$). 

    \begin{equation}\label{eqn:dist_calc}
        \begin{aligned}
            a_x = \frac{A_x \cdot T_{yy} - A_y \cdot T_{xy}}{T_{xx} \cdot T_{yy} - T_{xy} \cdot T_{yx}} \\
            a_y = \frac{A_y \cdot T_{xx} - A_x \cdot T_{yx}}{T_{xx} \cdot T_{yy} - T_{xy} \cdot T_{yx}}
        \end{aligned}
    \end{equation}

    \vspace{5mm}
    This research does not aim to compare different template matching or sub-pixel interpolation algorithms. As correlation algorithm is not be changed during the course of the conducted experiments, measurement error analysis should be independent of it. Thus, indicating that \gls{lsp} quality is vital to correlation quality.
    
    
    \textbf{Intensity Gradient} is the directional change in intensity of a pixel in an image. Image gradients can be calculated from an original image by convolving with a \emph{Sobel Operator}. Because gradients can change in horizontal as well as vertical directions, two sobel operators are needed. Namely, $G_x$ and $G_y$ for X and Y directions respectively.

    \vspace{5mm}
    \noindent Sobel operator is a discrete differentiation operator, which calculates approximate gradient of image intensity function. A $3\times3$ kernel Sobel operator is used for \gls{lsp} captured for 3 different exposure times. Then, magnitude of intensity gradient for each pixel is calculated as given by the Eqn. \ref{eqn:mag_eqn}, after the gradients had been calculated for X and Y directions using Eqn. \ref{eqn:g_x} and Eqn. \ref{eqn:g_y}. The results of the Sobel operation and resulting gradient magnitude after binary thresholding, are displayed in Fig. \ref{fig:sobel.png}. This figure shows how over-/underexposed images have lower \gls{mig} values, because of lesser number of pixels having a higher gradient values (indicated by white pixels). Finally, in order to calculate average intensity gradient for the whole frame, the magnitude of gradients was summed up for all pixels and divided by the total number of pixels inside the frame, as given by Eqn. \ref{eqn:mig}, where $m$ and $n$ denote the number of rows and columns of pixels inside the frame respectively. To calculate average \gls{mig} for a certain pair of exposure time and gain (See Eqn. \ref{eqn:avg_mig}), \gls{mig} across all frames are added and divided by total number of frames. 

    \begin{equation}
        G_x = 
        \begin{bmatrix}
            -1 & 0 & 1 \\
            -2 & 0 & 2 \\
            -1 & 0 & 1 
        \end{bmatrix}
        \label{eqn:g_x}
    \end{equation}

    \begin{equation}
        G_y = 
        \begin{bmatrix}
            -1 & -2 & -1 \\
            0 & 0 & 0 \\
            1 & 2 & 1 
        \end{bmatrix}
        \label{eqn:g_y}
    \end{equation}

    \begin{equation}
        G = \sqrt{G_x^2 + G_y^2}
        \label{eqn:mag_eqn}
    \end{equation}

    \begin{equation}
        \text{\gls{mig}} = \frac{1}{m \cdot n} \sum_{i=0}^{m} \sum_{j=0}^{n} G_{ij}
        \label{eqn:mig}
    \end{equation}

    \begin{equation}
        \text{Avg. \gls{mig}} = \frac{\sum_{i=0}^{n} \gls{mig}_i}{\text{Total number of frames}}
        \label{eqn:avg_mig}
    \end{equation}

    \begin{figure}[h]
        \centering
        \begin{subfigure}[b]{0.95\textwidth}
            \centering
            \includegraphics[width=\textwidth]{images/b_fundamentals/sobel_gradient.png}
            \caption{Gain: 0, Exposure Time: \SI{150}{\micro\second}}
            \label{fig:sobel_gradient.png}
        \end{subfigure}
        \begin{subfigure}[b]{0.95\textwidth}
            \centering
            \includegraphics[width=\textwidth]{images/b_fundamentals/sobel_underexposed.png}
            \caption{Underexposed \gls{lsp} with Gain: 0, Exposure Time: \SI{20}{\micro\second}}
            \label{fig:sobel_underexposed.png}
        \end{subfigure}
        \begin{subfigure}[b]{0.95\textwidth}
            \centering
            \includegraphics[width=\textwidth]{images/b_fundamentals/sobel_overexposed.png}
            \caption{Overexposed \gls{lsp} with Gain: 0, Exposure Time: \SI{1000}{\micro\second}}
            \label{fig:sobel_overexposed.png}
        \end{subfigure}
        \caption{Grayscale colormaps for three different \glsplural{lsp} after Sobel operations along X and Y directions and resulting magnitude.}
        \label{fig:sobel.png}
    \end{figure} 